; PlatformIO Project Configuration File
; RuntimeStorage Library Example for ESP32 Boiler Controller

[platformio]
default_envs = esp32dev

[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    colorize
    time

; Build flags
build_flags = 
    -D CORE_DEBUG_LEVEL=3
    -D CONFIG_ARDUHAL_LOG_DEFAULT_LEVEL_DEBUG
    -D RUNTIME_STORAGE_DEBUG=1
    ; I2C pins to avoid Ethernet PHY conflicts
    -D I2C_SDA_PIN=33
    -D I2C_SCL_PIN=32
    ; Fixed-point temperature format
    -D USE_FIXED_POINT_TEMPERATURE
    ; FreeRTOS settings
    -D configUSE_PREEMPTION=1
    -D configUSE_TIME_SLICING=1
    -D configUSE_MUTEXES=1
    -D configUSE_RECURSIVE_MUTEXES=1

; Library dependencies
lib_deps = 
    Wire
    SPI
    ; Local RuntimeStorage library (adjust path as needed)
    file://../..
    ; Optional: Add other libraries used in boiler controller
    ; arduino-libraries/NTPClient@^3.2.1
    ; knolleary/PubSubClient@^2.8
    ; bblanchon/ArduinoJson@^6.21.3

; Memory settings for ESP32
board_build.partitions = default.csv
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = qio

; Upload settings
upload_speed = 921600
upload_port = /dev/ttyACM0  ; Adjust for your system

; Monitor settings
monitor_port = /dev/ttyACM0  ; Adjust for your system
monitor_rts = 0
monitor_dtr = 0

; Test settings
test_build_src = yes

[env:esp32dev_ota]
; OTA-enabled environment
extends = env:esp32dev
upload_protocol = espota
upload_port = 192.168.1.100  ; Replace with your ESP32 IP
upload_flags = 
    --port=3232
    --auth=your_ota_password  ; Set your OTA password

[env:esp32dev_debug]
; Debug environment with J-Link
extends = env:esp32dev
debug_tool = jlink
debug_init_break = tbreak setup
build_type = debug
build_flags = 
    ${env:esp32dev.build_flags}
    -O0
    -g3
    -ggdb3